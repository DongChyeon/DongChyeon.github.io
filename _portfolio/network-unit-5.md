---
caption: #what displays in the portfolio grid:
  title: 컴퓨터 네트워크 5단원
  subtitle: 데이터 계층 - 컨트롤 영역
  thumbnail: https://velog.velcdn.com/images/dongchyeon/post/933d1758-bdc6-4d1c-bd85-f5ebab109978/image.png
  
#what displays when the item is clicked:
title: 컴퓨터 네트워크 5단원
subtitle: 데이터 계층 - 컨트롤 영역
image: https://velog.velcdn.com/images/dongchyeon/post/933d1758-bdc6-4d1c-bd85-f5ebab109978/image.png #main image, can be a link or a file in assets/img/portfolio
---

## 라우팅 알고리즘

`라우팅 알고리즘(routing algorithm)의 목표` : 송신자부터 수신자까지 라우터의 네트워크를 통과하는 좋은 경로(루트)를 결정하는 것

일반적으로 '좋은' 경로는 최소 비용 경로를 말하지만 현실적으로는 네트워크 정책과 같은 실제 문제가 고려된다.

### 그래프

라우팅 문제를 나타내는 데는 그래프가 사용된다.

![](https://velog.velcdn.com/images/dongchyeon/post/933d1758-bdc6-4d1c-bd85-f5ebab109978/image.png)

그래프(graph) `G(N, E)`

* `N` : { u, v, w, x, y, z}
  - 노드(node)의 집합
  - 네트워크 계층 라우팅 상황에서 그래프상의 `노드`는 패킷 전달 결정이 이루어지는 지점인 라우터를 나타낸다.

* `E` : { (u, v), (u, x), (v, x), (v, w), (x, w), (x, y), (w, y), (w, z), (y, z) }
  - 엣지(edge)의 집합
  - 네트워크 계층 라우팅 상황에서 그래프 상의 `엣지`는 라우터들 간의 물리 링크를 나타낸다.
  - 엣지는 그 비용을 나타내는 값을 가진다. (일반적으로 해당 링크의 물리적인 거리, 링크 속도, 링크와 관련된 금정 비용 등을 반영)
  - 집합 E에 포함된 어떤 엣지 (x, y)에 대해 `c(x, y)`는 노드 x와 y간의 비용을 의미한다.
  

### 라우팅 알고리즘의 분류

라우팅 알고리즘을 분류하는 일반적인 방법 한 가지는 `중앙 집중형`인지 `분산형`으로 분류하는 것이다.

### 중앙 집중형 라우팅 알고리즘 (centralized routing algorithm)

> 네트워크 전체에 대한 완전한 정보를 가지고 출발지와 목적지 사이의 최소 비용 경로를 계산한다.

라우터가 자신이 속해 있는 네트워크 전체 라우터의 정보를 공유한다. 전체 상태 정보를 갖는 알고리즘을 `링크 상태(link-state, LS) 알고리즘`이라고 한다.

### 분산 라우팅 알고리즘 (decentralized routing algorithm)

> 각 노드는 자신에게 직접 연결된 링크에 대한 비용 정보만을 가지고 시작한다.

이후 반복된 계산과 이웃 노드와의 정보 교호나을 통해 노드는 점차적으로 목적지 또는 목적지 집합까지의 최소 비용 경로를 게산한다.

분산 라우팅 알고리즘은 `거리 벡터(distance-vector, DV) 알고리즘`이라고 하는데, 이는 각 노드가 네트워크 내 다른 모든 노드까지 비용(거리)의 추정값을 벡터 형태로 유지하기 때문이다.

<hr>

다른 분류 방법은 `정적 알고리즘`과 `동적 알고리즘`으로 분류하는 것이다.

### 정적 라우팅 알고리즘(static routing alorithm)

관리자가 직접 개입해서 링크 비용을 수정하기 때문에 경로가 느리게 변한다. 소규모, 변화가 거의 없는 네트워크 환겨엥서 쓰이며 복잡한 소프트웨어 구현이 불필요하다.

### 동적 라우팅 알고리즘(dynamic routing algorithm)

네트워크 트래픽 부하(load)나 토폴로지 변화에 따라 라우팅 경로를 바꾼다.

동적 알고리즘은 주기적으로, 혹은 토폴로지나 링크 비용의 변경에 직접적으로 응답하는 방식으로 수행된다.

## 링크 상태(LS) 라우팅 알고리즘

1. 각 라우터는 전체 네트워크의 구성(topology)과 링크 상태 정보를 유지
2. 각 라우터는 전체 네트워크 상태 정보를 이용하여 모든 목적지 네트워크까지의 최적 경로 계산
3. 최적 경로를 기반으로 각 네트워크에 대한 라우팅 테이블을 구성

### 다익스트라 알고리즘(Dijkstra's algorithm)

> 하나의 노드에서 네트워크 내 다른 모든 노드로의 최소 비용 경로를 계산한다.

`D(v)` : 알고리즘의 현재 반복 시점에서 출발지 노드부터 `목적지 v`까지의 최소 비용 경로의 비용
`p(v)` : 출발지에서 v까지의 현재 최소 비용 경로에서 v의 직전 노드
`N'` : 노드의 집합

### 거리 벡터(DV) 라우팅 알고리즘

`벨만-포드(Bellman-Ford) 식`

<img src = "https://velog.velcdn.com/images/dongchyeon/post/a5fbe652-512d-4381-a89d-78f136a4acec/image.png" width="100%">

거리 벡터 라우팅 알고리즘의 기본 아이디어는 다음과 같다.

>출발지 노드를 x라고 가정하면, 노드 x는 자신으로부터 집합 N에 속한 다른 모든 노드 y까지의 최소 비용 경로 D.x(y)를 추정한다.

1. 각 라우터는 자신이 속한 네트워크 상태 정보로 각 네트워크에 대한 거리 경로 정보를 갱신
2. 거리 경로 정보를 이웃 라우터와 공유함
3. 이웃 라우터들의 거리 경로 정보를 사용하여 각 네트워크에 대한 최적 거리 경로 정보 갱신
4. 최적 거리 경로 정보가 갱신되면 라우팅 테이블을 갱신함

### 링크 상태 알고리즘과 거리 벡터 라우팅 알고리즘의 비교

|링크 상태 알고리즘|거리 벡터 라우팅 알고리즘|
|---|---|
|모든 라우터로부터 망 정보를 수집|인접한 이웃으로부터 망 정보를 수집|
|최단거리 알고리즘으로 모든 라우터에 대한 비용을 직접 계산|비용은 이웃 라우터와의 거리 비용을 더해서 구함|
|빠른 수렴 시간|느린 수렴 시간|
|자신에게 직접 연결된 망 정보만 전달|모든 라우팅 테이블 값을 이웃에게 전달|
|멀티캐스트 방식으로 라우팅 광고|브로드캐스트 방식으로 이웃에게 라우팅 광고|

## 인터넷에서의 AS 내부 라우팅: OSPF

네트워크를 동일한 라우팅 알고리즘을 수행하는 동종의 라우팅 집합으로 간주하는 관점은 다음 두 가지 문제점을 가진다.

1. `확장` : 라우터의 수가 증가함에 따라 라우팅 정보의 통신, 계산, 저장에 필요한 오버헤드가 걷잡을 수 없이 증가한다.
2. `관리 자율성` : ISP는 일반적으로 자신의 네트워크를 원하는 대로 운용하거나 네트워크 내부 구성을 외부에 감추기를 원한다.

### 자율 시스템

위의 문제점들은 라우터들을 `자율 시스템(autonomous system, AS)`으로 조직화하여 해결할 수 있다.

* 각 AS는 동일한 관리 제어하에 있는 라우터의 그룹으로 구성된다.
* 자율 시스템은 전 세계적으로 고유한 `AS 번호(automous system number, ASN)`으로 식별된다.
* 같은 AS 안에 있는 라우터들은 동일한 라우팅 알고리즘을 사용하고 상대방에 대한 정보를 갖고 있다.
* 자율 시스템 내부에서 동작하는 라우팅 알고리즘을 `AS 내부 라우팅 프로토콜(intra-autonomous system routing protocol)`이라고 한다.

### 인트라-AS 라우팅

단일 자율 시스템(AS) 내에서 사용되는 라우팅 프로토콜을 말한다. 자율 시스템은 단일 관리 도메인 하에 있는 네트워크의 집합이다. 해당 라우팅은 동일한 AS 내의 라우터들 사이에서 라우팅 정보를 교환하여 AS 내에서 트래픽을 전달하기 위한 최적의 경로를 결정하는 역할을 한다.

일반적으로 사용되는 인트라-AS 라우팅 프로토콜로는 다음이 있다.

* `라우팅 정보 프로토콜(RIP)` : 네트워크의 경로 선택을 위해 패킷이 목적지에 도달하기까지 거친 라우터의 수를 나타내는 홉 카운트(metric)을 사용한다.
* `개방형 최단 경로 우선(Open Shortest Path First, OSPF)` : 링크 대역폭과 지연 등의 메트릭을 사용하여 최단 경로를 계산하는 링크 상태 프로토콜이다.
* `IGRP(Interior Gateway Routing Protocol)` : RIP의 발전된 버전으로, 네트워크 경로 선택에 홉 수와 함께 대역폭, 지연, 신뢰성, 대용량 링크 등 다양한 요소를 고려한다.

### 인터-AS 라우팅

서로 다른 자율 시스템 간의 라우팅 정보 교환에 관련된다. 인터-AS 라우팅 프로토콜은 AS 간의 경로를 결정하고 라우팅 정보를 교환하는 역할을 담당한다.

### 개방형 최단 경로 우선(OSPF) 프로토콜

OSPF는 링크 상태 정보를 플러딩(flooding)하고 다익스트라 최소 비용 경로 알고리즘을 사용하는 링크 상태 알고리즘이다.

* OSPF를 이용하여 각 라우터는 전체 AS에 대한 완벽한 토폴로지 지도(그래프)를 얻는다.
* 각 라우터는 자신을 루트 노드로 두고 모든 서브넷에 이르는 최단 경로 트리를 결정하기 위해 혼자서 다익스트라 최단 경로 알고리즘을 수행한다.
* OSPF를 사용하는 라우터는 자율 시스템 내의 다른 모든 라우터에게 라우팅 정보를 브로드캐스팅한다.
  - 링크 상태가 변경될 때마다
  - 링크 상태가 변경되지 않았더라도 정기적으로
* OSPF 메시지에 포함된 상태 정보는 인터넷 프로토콜에 의해 전달되며, 상위 계층 프로토콜 번호로는 OSPF를 의미하는 `89`를 갖는다.
  - 따라서 OSPF 프로토콜은 신뢰할 수 있는 메시지 전송과 링크 상태의 브로드캐스트와 같은 기능을 스스로 구현해야 한다.
  - 또한 OSPF 프로토콜은 링크가 동작하고 있는지 검사하고, OSPF 라우터가 네트워크 전반의 링크 상태에 대한 이웃 라우터의 데이터베이스를 얻을 수 있도록 해야 한다.
  
### 계층적 OSPF

OSPF의 자율 시스템(AS)는 계층적인 영역으로 구성될 수 있다.

* 각 영역은 자신의 OSFP 링크 상태 라우팅 알고리즘을 수행한다.
* 한 영역 내의 라우터는 같은 영역 내의 라우터들에게만 링크 상태를 브로드캐스트한다.
* 각 영역 내에서 하나 혹은 그 이상의 `영역 경계 라우터`가 영역 외부로의 패킷 라우팅을 책임진다.
* `백본 영역`의 주요 역할은 AS 내 영역 간의 트래픽을 라우팅하는 것이다.

AS 내 영역 간 라우팅을 위해서는,

1. 영역 경계 라우터로 패킷을 라우팅한다. (영역 내 라우팅)
2. 백본을 통과하여 목적지 영역의 영역 경계 라우터로 라우팅한다.
3. 그 후 최종 목적지로 라우팅한다.

## 인터넷 서비스 제공업자(ISP) 간의 라우팅: BGP

패킷이 여러 AS를 통과하도록 라우팅할 때, `자율 시스템 간 라우팅 프로토콜 (inter-autonomous system routing protocol)`이 필요하다.

통신하는 AS들은 같은 AS 간 라우팅 프로토콜을 수행해야만 하며 실제로 인터넷의 모든 AS는 `경계 게이트웨이 프로토콜(Border Gateway Protocol, BGP)`을 사용한다.

<img src = "https://velog.velcdn.com/images/dongchyeon/post/1655bf52-011b-4977-a43d-1732d9bf2584/image.png" width="100%">

각 AS에서 각각의 라우터들은 `게이트웨이 라우터(gateway router)` 또는 `내부 라우터(internal router)`다.

`게이트웨이 라우터(gateway router)`
* AS의 경계에 있는 라우터
* 다른 AS들에 있는 하나 또는 여러 개의 라우터와 직접 연결된다.

`내부 라우터(internal router)`
* 자신의 AS 내에 있는 호스트 및 라우터와만 연결된다.

자율 시스템(AS)는 서로 메시지를 보내지 않고 라우터가 보낸다.

`BGP 연결(BGP connction)`
* BGP에서 라우터의 쌍들은 포트번호가 179이고 반영구적인 TCP 연결을 통해 라우팅 정보를 교환한다.
* 이 TCP 연결읕 통해 모든 BGP 메시지가 전송된다.

`외부 BGP(external BCP, eBGP) 연결`
* 2개의 AS를 연결하는 BGP 연결

`내부 BGP(internal BGP, iBGP) 연결`
* 같은 AS 내의 라우터를 연결하는 BGP 연결

보통 각기 다른 AS에 속하는 게이트웨이 라우터들을 직접 연결하는 링크에는 eBGP 연결이 존재하며 각 AS 내부 라우터 간에는 iBGP 연결도 존재한다.

### BGP 경로 정보 알리기

<img src = "https://velog.velcdn.com/images/dongchyeon/post/49e5786a-0aff-443b-9916-a47186d0d886/image.png" width="100%">

위 예시에서 `x`에 대한 경로 정보를 AS1과 AS2의 모든 라우터에 알리는 작업을 생각해보자.

1. 게이트웨이 라우터 3a가 게이트웨이 라우터 2c에게 `AS3 x`라는 `eBGP 메시지`를 보낸다.
2. 게이트웨이 라우터 2c가 `iBGP 메시지` `AS3 x`를 게이트웨이 라우터 2a를 포함한 AS2 내부의 모든 라우터에게 전송한다.
3. 게이트웨이 라우터 2a가 `eBGP 메시지` `AS2 AS3 x`를 게이트웨이 라우터 1c에게 보낸다.
4. 마지막으로, 게이트 라우터 1c가 iBGP를 사용하여 AS1 내의 모든 라우터에게 메시지 `AS2 AS3 x`를 전달한다.

### BGP 관련 용어들

AS-PATH
* 알림 메시지가 통과하는 AS들의 리스트를 담는다.
* 메시지의 루프를 감지가혹 방지하기 위해 활용한다.

NEXT-HOP
* AS-PATH가 시작되는 라우터 인터페이스의 IP 주소

### 뜨거운 감자 라우팅(hot potato routing)

>가능한 모든 경로 중, 경로 각각의 시작점인 NEXT-HOP 라우터까지의 경로 비용이 최소가 되는 경로를 선택한다.

즉, 뜨거운 감자 라우팅은 오로지 자신의 경로 중에서 자기 AS 내부 비용만 줄이려는 이기적인 알고리즘이다.

### 라우팅 정책

라우터가 목적지까지의 경로를 선택하려고 할 때 `AS 라우팅 정책`은 최단 AS-PATH나 뜨거운 감자 라우팅 등의 다른 모든 고려사항보다 우선시된다.

아래 그림에서 A, B, C, W, X, Y 6개의 `자율 시스템(AS)`이 서로 연결되어 있다.

W, X, Y는 `사용자 접속 ISP`이고 A, B, C,는 `백본 제공자 네트워크`다.

<img src = "https://velog.velcdn.com/images/dongchyeon/post/fc8ff2c4-4679-45ba-8037-85bff41e31d9/image.png" width="100%">

ISP가 오직 그들의 사용자 네트워크에만 트래픽을 전달하길 원한다고 가정해보자.

1. A가 A-w 경로를 B와 C에게 알린다.
2. B는 C에게 B-A-w 경로를 알리지 않는다.
3. C는 w에 도달하기 위해 C-A-w 경로를 거칠 것이다.

2번 과정에서 C, A, w 모두 B의 사용자가 아니기 때문에 C-B-A-w로 라우팅하는 이득이 없기 때문에 해당 경로를 알리지 않는다.

## 소프트웨어 정의 네트워크(SDN) Control plane

### 논리적으로 중앙 집중화된 Control Plane이 필요한 이유

* `쉬운 네트워크 관리`: 중앙 집중화된 Data plane을 통해 네트워크 관리자가 전체 네트워크에 대한 전반적인 상황을 볼 수 있으며, 중앙 위치에서 네트워크 장치를 구성, 모니터링 및 관리할 수 있다.
* `라우터 구성 오류 회피`: 네트워크 정책, 구성 및 업데이트를 모든 장치에 일관되게 적용해, 구성 오류의 위험을 최소화할 수 있다.
* `트래픽 흐름의 더 큰 유연성`: 네트워크 관리자가 동적으로 트래픽 흐름을 정의하고 제어할 수 있다.


### SDN 구조의 특징

- 플로우 기반 포워딩
`SDN`으로 제어되는 스위치들에서의 패킷 전달은 트랜스포트 계층, 네트워크 계층, 또는 링크 계층 헤더의 어떤 값을 기반으로 하든 이루어질 수 있다.

### SDN 구조

<img src = "https://velog.velcdn.com/images/dongchyeon/post/768c0ee7-145f-4ef6-b5f3-ac5025fcb605/image.png" width="100%">

`Network-control apps`
* 하위 수준 서비스 및 SDN 컨트롤러가 제공하는 API를 사용하여 제어 기능 구현
* 보안, 부담 분산, 경로 설정 등을 소프트웨어로 제어 가능
    
`SDN Controller`
1. 정확한 네트워크 상태정보(원격 링크와 스위치, 호스트들의 상태)를 유지하고,
2. 북쪽 인터페이스(API)를 통해 상위 네트워크 제어 애플리케이션과 상호 작용하며,
3. 남쪽 인터페이스(API)를 통해 네트워크 스위치와 상호 작용한다.
4. 성능, 확장성, 고장 허용성, 강건성을 위해 분산 시스템으로 구현하며, 논리적으로는 통합된 상태이다.

`SDN-controlled switches (Data plane switches)`
* 하드웨어에서 일반화된 Data plane 전달을 구현하는 간단하고 빠른 상용 스위치
* 스위치 플로우 테이블은 컨트롤러에 의해 계산되고 설치
* 테이블 기반 스위치 제어를 위한 API
* 컨트롤러와의 통신을 위한 프로토콜

### OpenFlow Protocol

* OpenFlow 프로토콜은 SDN 컨트롤러와 SDN으로 제어되는 스위치 또는 OpenFlow API를 구현하는 다른 장치 사이에서 동작한다.
* OpenFlow 프로토콜은 TCP 상에서 기본 포트 번호 `6653`을 가지고 동작한다.

컨트롤러가 제어되는 스위치로 전달하는 중요한 메시지는 다음과 같다.

* `설정(configure)` : 컨트롤러가 스위치의 설정 파라미터들을 쿼리하거나 설정할 수 있도록 한다.
* `상태 수정(modify-state)` : 컨트롤러가 스위치 플로우 테이블의 엔트리를 추가/제거 또는 수정하거나 스위치 포트의 특성을 설정하기 위해 사용한다.
* `상태 읽기(read-state)` : 컨트롤러가 스위치 플로우 테이블과 포트로부터 통계 정보와 카운터값을 얻기 위해 사용한다.
* `패킷 전송(packet-out)` : 컨트롤러가 제어하는 스위치의 지정된 포트에서 특정 패킷을 내보내기 위해 사용한다.

SDN으로 제어되는 스위치에서 컨트롤러로 전달되는 주요 메시지는 다음과 같다.

* `플로우 제거(flow-removed)` : 컨트롤러에게 어떤 플로우 테이블 엔트리가 시간이 만료되었거나 상태 수정 메시지를 수신한 결과로 삭제되었음을 알린다.
* `포트 상태(port status)` : 스위치가 컨트롤러에게 포트의 상태 변화를 알리기 위해 사용된다.
* `패킷 전달(packet-in)` : 패킷을 컨트롤러에게 전달하기 위해 사용된다.

### OpenDaylight (ODL) controller

<img src = "https://velog.velcdn.com/images/dongchyeon/post/b5f4fecc-0cd1-4f99-af27-9f6576434e6b/image.png" width="100%">

* ODL의 기본 네트워크 서비스 기능들을 컨트롤러의 핵심부에 있다.
* `서비스 추상 계층(Service Abstraction Layer)`
  - 컨트롤러 구성요소와 애플리케이션이 서로의 서비스를 호출하고 그들이 생성한 이벤트에 대한 알림을 받을 수 있도록 한다.